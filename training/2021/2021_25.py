"A straightforward grid problem"
import logging

import numpy as np

logging.basicConfig(
    level=logging.INFO, format="%(asctime)s - %(levelname)s - %(message)s"
)

INPUT_TEST = """
v...>>.vv>
.vv>>.vv..
>>.>v>...v
>>v>>.>.v.
v>v.vv.v..
>.>>..v...
.vv..>.>v.
v.v..>>v.v
....v..v.>"""

INPUT = """v>...>>>.>v.v..v.>.>.>>>..v..v.>.v.vv>.....>>>>v...>>.>..v>.>vv.>.v.>vv..v.v.v.>.v.....v..v>v>.v....vvvv>v.v.v>v.v>vv..>.v...>>>vv.v.v.>>..
v>.>.v....>...v..v.>.>..>.v.>..>vv.....>..>..vv..vvvvvv.>v>.>.>.>vv....>.v.vv...>..v.....v......v>.v..>v.v>..>.>.v.vvvv>..vv.>v>v.v.vv.v.vv
...vv...vv.>.v..v..>.>....v.>..>...v>...v>...vv>......>>vvv>.>v>.>>vvvv>...v..>>.v..v.>vv..........>v>v>...>.>v.>v>.v..>....v..>>>>...vv..>
>>...>.>....vv.v..>>..v...>>...>.v.>vvv...>v..>>v.vv>..>...v..v.v>vv..>vv..>.v..v..>v.v..>........>.v>v..vvv.v...vvv.>..vvv.>>.v..v.....vv.
>v.>.vv>>...>>v...>..>.>.v.v>.v..v.>>.v.>.v..>.v.v.vv>.v.vv>>vv..>..>..>v.v.....>.v..v>>.v.>vv...>.>.>>>.vv>>>>...v.>..vv.v...v......v...v>
.v...v>.>v.v..v.v...v>v.v>vvv>..>..vv.vv>v.v.....vvv....vv>....>.....v>v.>.v>..v...>>v>v....>>v.>.>v..v>.v.v.vv>v.>v.>v..vv..>v.....>..>..v
.vv.>.>>....>v>v.......>..>.>>......v.v..>>...v.>v>..v>.>..>.>>vv>>...>>..v.v.v....v.>..v..>....>.........vvv...>.>.>..v>>v>..v>.v..v>.v>>.
.v>...vv>v.>v...>vv.v.>.>v.v..>.v.>>>..v...>>>.>.v...........>v..>v>v.>vv....vvv.v.v>..>v>.>>..vv.>..v>>v.v......>.>>vv>.v>v.v.>>..>v>>>v.v
.v......v>>>v>v..v.>>v>.v..v>.>>>.v.>>>....v.....v..v..>.>>>v.>v......v....>v.>...v>.v.>.>v..>>.v.>v>v>...>vvvv...>v>..>vv.>....>.v.v.v....
v....>.>v>.>..>...>v..v.>v..vv.>.>v>vv..>vv>>>>>v.v>..>v..>.>...v>v..>>>>.>.v.v..>.>..v.v>...>..>.>>v..>v..>vv>.v>>...>>>.>vv>v...>...>>>>.
>.>v.v.vv>v..vv.v..v>v..v>......>v.>>>.>>>v..v.v.v>..v.vv....v..>v.v>v>.>.>v.v>>.>.v....v.....>v.>v.vv.>......v...v...>...>vvv.......>>.v..
.v..v.v.>>v...v>>...>vv.>.vvv>.v>vv.>vv>.>v.v>>>>>....>v.v>vvv>v.v>.>..>...>..>.vv..v>>.>...v>v..v...v.v>v.>>.>.v>....v.v.v..>>>.vvv>.vv>>>
.vvv>...vv.v>.>>v.>v>>>v>vv........>v..v.>..>...v..v..v..v>...v.>......>>v>>.>v..>>vv>....>.>vvv.vvv...v.>..v.>>.>>.>...>.vv.....v..>v>.v>>
>>>.v.v.v.v>.v>.>.>v.>.>.....>.v>.>..>.>..v.>>v..>...v...>>.....>v.>..vvv..>v..>...vv>..v>.v.v>>v.vv>.>v..>..>>.v>.v..>..v.>v>v.>v..>>>vv.v
.v.....>..>v>>vv...>.v.....vvv>.v>..vv.....>..>.............>..>.v>v>vv.>.>.>.v.>...>>.>>.>.>v..>>v.>...>v...v>.v..vv..>>v>.>..v>.vvv...v.v
v.>v..>v>.>v>v...vv.vvvvv.>.vvv...v..>>v.......>vv.v.vv.v.v.vv>..>>>v>>.v>.>>>.>vv.v>>v.vv..>>.v>.v>.v...v...v..>..v...v>v>.v...v.>>vv.v.>>
v>.v.v.>.>...>v.v..v..vv..vv>.v>.vv..>......>>vv>>..>..>v>.>>v.....vv>.>.>v>..>v.>.>>.....>.v>..v....v....>v.v>....v.>.v.v.vvv>.....>v.>.v.
....>>>v.>>.v.>..v...>.v.>..>.>v.>....>v..v.>....v...>...v....>.v>>v.>>v>vv..v>v....>v...>>v.v>>....>..>.vv.v.vv>v>>>>>.v.>v>v.v..>..>v....
...>>v>v.>>...>..vvvvv>.v.vv.>.v.>>v>..v.vv>v.>vv.....>.vvv>>>v.v..vvvvvvv.>>vvv>v...>..>.v>>v>...vv>..>..>......v..>.v..>v>>.>>>>..v.>>v.v
..vvvv..v.>>.>.>>>.v.v..v.>v.>.v>v.v>..>.v.v.v.>..v>>.>...vvv.v..>...v....v.v>vv>...v.vv>..>vv.v>v>v...>.vv....>.v>...>v...>>>>..>>....vvvv
v..v.>>>>v..>vvvv>.>v.>v...>>..>v>v...v.>......>>>.......vv.vv>..>...v..>vvv.>.>.v>v.v>.v>......>...v.>..>.v.>.>v>..>....vv.>....vvv...v...
.v.v>....>.>..>...v>..v>>..>>.v.v>v.>.>..>.>.v....>v......vvv>..>>.....>.v..v>.v>v..>.v..v..vvv.v>..>.>.v...>..vv.>v.>v>..v>..>...>.>>.vv.>
v.vv>v.vv...>..>..>..>..>vv>v.>..>.>..>v..>>v>.vvvv>v.>v>vv.>v...vv.v.v.v...vv>.>.....vvvv..>v..v..vv.>v>v.v.>..>.v..>.....vv>>.....vv>...v
..v..v.>>.>v..v>..>...v...>v>>.vv>.>>.v..v>...>..>>..vv.>.v.>>..v>vv>..vv>vv>.v>...vv...v.>>.v..v>.v>>.v.....v..vv>>v>>v>...>v...>.....>.>>
..v....>vv>v.vv..........vv..>>.vv......v..vvv..v>>>v.v.>>.v>>..v..>..vv>v..>>>..>......>v>vv>.>>v....v.v>>.v.>....>>..>v>>.>...>..>vv..>v>
>...>.>>>.>.v..>v>>..v.....>>......v>>..v....>.>v>.>v.>>>vv....>v.v...v..>.>.v.v..>vv>.v>>..v.>vv>.>>...v..>vv.v>.>>.....>.v.v..v...v..>v>>
v....v>.>>>vv>..v>>v....>>>..vvv.>.>..vv...v..>>v.>...>>....>>>.>.>.v.v.......>.v..vv>vv...>v.>v>v.v>v.>>v>v>v>.....>.v>..>...>v>v>...>.v.v
v...>.>.....>.v>vv>>.v..vv..v.v.v.vvvvv.v...v>>.v>...v.v....vv....v>v.>v.>v..>..v.v>>..v>vv>vv.v.>>>.>...v.v..>.v>v>v..v>....v>>..vv>.>>.>v
.v>>..v.vvv......vv...v>.>>v....v....v...>>.>v.>...v.v>>..>>.>v..>.v.........vv.>>>>vv.>..vvv...v....>.>v..v.....v.v..v>.v.............vv>v
v..v.vv..>>....v.>...vvvvvv.v>.....>..v.>>>.v.v>..v.>vv..>.....>v.>v.v.v>......v..>>.>v...vvv>.v>v..>>>>v.>...>...v>.>v.>.>>.....vvv....vv.
....>>..>...>v.>>...v..v.>..>vvv>>v.v>>.vv>...v>....>vv>.vv.>v>>>v..>>>..>.>v..>>v.>vv.>......v>>v.vvv.v.v>.v.v...vv>>vv..>....v>....vv..vv
.>vv>.....vv>.v...>>..>>vv.>>v>...>v..>>.v>v....>....v......>v..v>...v.vv.vv..>v.>.v.>>...>.v..v.v.vv..>.>>vv.>>...>.>..>.v>..v>>v.vv.v.vvv
v.vv.v>>vv>vvv..v.......>>....>v..v>..v.v>v>.>v.v..>v>.v>v.v...>...vv...>.>.>>......v...>...v>..>.v>..vvv>.vvv>vv>>>>...v.vv.>.v.v..v.v>.>v
..>>>..>>v.v...>..>..vvv.v.>>.>.>.v.v..vv>>..>>.v.v.......vvv.>.v..>v>........>.v.>v...>..v>v...>.......>>..>v>.....>vv.v>v.v..>>...v....>.
v.>>>>..>..>>>.vv..>.>..vv..vv..v...>v>...v.>v.>.vv>..v>.....>.>v>.vvv.>.>>v.>..v..v.v...vv.>...>..>>>.>..>.v.>.>..v.v..v>>.v...>v>>.>.v..v
>v.v>v>.v>>v>....v.v>v.>.v..>>....v>v.>>>.vv>.vv....>..v>.vv.>.vvv.v..>....v.......vvv.v>v>v..v..v....v>v>v>.v..v.>..>....>>>..>..v.v.>...v
>>...v>vv>>...vv>>..>.vvvvv>.>.vv.>v>.>.>>>v..>>v..>vv.>>>>..>v...v.v>.......>vv>>...v>.v..>>.>.>v>..>>.....>.>..>vv..>.>..>vvv>.vv.vv>v.>.
...>.>v.>>vvv>vv>>...v.>v...vv>.>.>v.>....>...v.>v.vv.>vv>.>.>.>...>...>>>.v......>.....v.vv.....v.>>..>..v...vvv.>...v..vv>v>..v.>..v..>.v
v>v>>..v>v...>.>vv.>...>>v.>vvv..vv>.>v.....v>v.>v..>v...>..>.>.>v.>.....>..>vv>v..>...v.vv>.v>>v.>v....v>.....v......>..>.........>>...>v.
v.>.>>>.>v>.......v..>v>v....>..v....v.>.....vv.>.>.>>>v..>v..>.v.vv>...v>vv.>v.>...>>..>>>>v..>v.....>.>>>v..>.>>v.>>>......v.>.>vv..vv.>.
.v..v>vv..>..>.vv..v>.>..>>...>>v>..v.....v....v..v.>.v....vv>.v>...v>.vv.>..v>..>vvv.v>.>.v>..>.>...>..v>.vv.>.>.v>v>v..>.vv.>.>v..v>.>>>.
v....>>.>.vv..>v>.v.>..v>.>vv..>.>>.vv.>.v...>v.>.>v....v...vv>..>.>.vv>vv..>...v.>.....>.>..v...>>..vv......>v>vv>v>v..>v>>.>v..v...v..>..
>...>.>v>...>v.>vv.v>.>v.....v.>.>...v>v.v....>.v>..>..v.v>.....vv.vv.>...>vv.>..>.v>.v.....>>.>v.vv>>..v>..>...>v>vv.>v>.>..v>v...>>v.v..v
v>>v>>.vv..vv>vvv.>vv.>.v..vvvv.v>v>..v..vvv>.....>..>.>v..>....>.v>v..>>>..vv.v>v..>v.>>>>.>.vv.v..vvv>>.vv...>.>.>....>>v..>.v>..vvvv>..v
v..>>>.vv....v.v........v>>>..>>..v>..v...>..v>v>.>v......v..vv.v...v.v..>vv>>vv>v>.>>v>.>>>>.v>.....vv..v..>v..>..>vv>>.vv....>>.vv>v>....
.>...vvv......vvv....v...>....v.v.>>.v...>>v>...v>v>v>v.>>v>v>vv.>v.>>>...>.>v>v.v..v.vvv..>vvv..v.>>..vv.......>vvv.vv.vv....v.vvv.>v>..>v
..>.vv>...>>.v.v.v.>.>>..v..v.>..>v.v.v..v>>.>.vv>...vv>>vv.....>vv.>>>vv>>>>>.>.v>........vv.v>>..v.v>..v....>>....>....>>....>v..v>v>>vv.
.....v.v..v....>v...v.v>>.>...>.>>v.>..>>.>>...>>>v.v...v>>>..>v.v...vv.vv..>.>.>>>.v>..>>v>v>........>.vv.>.>v..>>>..>>.>v..>...vv.>..>v..
.v...v>..>.>v.v.v>>.v..>v>>v>>vv.>vv.v.v>v.v...>>.>.>.>>.>v.>..>>>v..v>>.......v>...vv.....>.>v.>v>v...v.>...>>>.v....>.>v....>.>..>..>>.v.
>>v>vv.>.v>.>v.vv>....v>>...v.vv..v....vv>.v....v>.>...v>.vv.v.>.v.>>>.vv.v>>..v.>.....>.>.v>vvv>>vv.v...v...v.>.v..>.v..>.>...v.>......>vv
.v..v..>.vv>..>vv..v>>...v>v.>.>..v>vv.v>vv.vvv.v>...v>v>...v...>v>......>.>v>>v..v.v.>v..vv......v.>.>....v.>.v..v>..>..>.vv..v..>>...>.vv
v>.v...>.v..>.>>.v..>v>.v.>v.v.>>>.v>.v>v.vv.v.>.>.>.v..v.v....v..>.v.v..v..>>.>v.>...v....>.vv..vv.v.>.>..vv>..v.v..v.>.>.v>.v.vvvvv..v.v>
...>.vvvv..v.>v...>v.>v.>...>>>.v>.>.>v>...>>>>>>.v.>>.......v>>v..v.vv.vvv.>.vvvv.vv>.>v>..v.>...vv.vvvv>>>v.>..>v.>...v>vvv.v.....v.vvvv.
>..>..v......>.>>...>v.>v....>.v>..>...>.>...>.>.vv.>>.v.>>.>>>>.vv.vv....>..vvvv...v>.>.>>.>>.>>.v..v>.>..>.vv...>....v>v..>.....v>..v>..>
>..>....v.....v..v.....v...v.>..v....v......>v>..v>.....>>>>..vv.v...>>>....v.>>v....v.v.>>...>>.>>...v..>>>.v..>>.>..>.v.>.vv..v..>.v>...>
.v>>.>>..>vvv.v..>v>..>.v.v..>v......v>>.>>v>>>...>..>>v.vvvv.>.....v..vv.v...>vv>>>v.v..v>..>.v>.>...>>....v>.>..>>>>>.v>>>vv..>>....v.v.>
..v.vv...>.vvv..v.>...>v.......>..v>>>>>.v.>......>v.v>..v.>.>.>>>v......>.v>..v.v>.>.v..v>>..>>>v>>.v..>..v.>...v.....>.vv>...v...>...v...
.v>>v>vv>...>..>.v>.v....v>.vv.v...>.>..>v.....>...>>.>...>>v>vvv.v>>..>..v>>v>..>..vv..>..>v...v...v>..>>..v.v.>vvv....v.v>vvv..>>vv...v.v
.>v>..v.>>.vv....v>..>>>>>>.>.>>..v>.v>..>.....v>>v..v..>..v.v>>vvv..>..>.>.>.vvv.>..vvv...vv>>>..>>..v>>>>>vvv.v.>>...>....vv..vv.v>..vvv>
..v..>.v>>...>.>>>.>v>>v.v.>..>>..>>>v.....>.>>>v>.v.>.v....>v.>>v...>v.v.>..>.>.v>vvvv...vvvvv...v..>>.v..v>......>.>>>...v.>.v...>.....vv
vvvv.v...>v....>>>>.....vv>>>>..vvv.v..v.vv....>v.v..vvv.v..>v>>..v...v.v.>v.vv.v.>>vv>..>..v..>>...v>..v>>>.vv.v.vv..v..vv......v>v.>vv...
.v>>>..vv..>..>..v..>>>vv.>.>.v.>>v..........vv.>..>.>>.v.....>v>v.v.....>.v.v..vvvv>>...>>..v.v>v.v.v...v.....>>>..v.vv...>>...v>v.>>>>.v.
..vvv.>...vv..>vvv.v>>.vv>vv.v..vv....>...>v>>.>.>...v>..>.vv...>>...>v.>...v.>v......vv...v>>>.>.>...>v....vvv>..>>>>v>v>vv>vv..>.v>.v>>..
v>.>v......v...>v.>>v.v>>...>v>>..>.>...>..v.>.v..v.>.>v>vv>>.v..v.>...>v..v.....v>v...>vv.>....>v....v..>v.>vv..>>v..>>.v..>>.v>..>v..v>..
v>.vv.....v>>vv.>>...v..>..>>.vv.v..vv.>vvvv...v.vvv>v>>.....>vvv..v>.v.>.......>>vv>...vvv>v>vv..>vvv...>.vv>>.v.>>.v..>>.....v....>.>>..v
>..>.>v.v..>...v..>>..>.v.>v..v.>.v>>.>.>v>vv>.v.>>..vv>v>..>vv.......>......v>.>>>v...>..>.v>.>v.v..v.>v....>.>.v>.v>v>>v.v.v>>>.vv...vvv>
......v.v...>...v.>>.>v..>.>v....>.>>>...v>v...v.vv.vv>.v..v>>.>v..vv...>.vvvv...v.>>>.v>>.v..>.v>v..>..>.>.vv..v>.>.v.v>>>v>.>..>.>..>>>..
v....v.vv..>>>>..vv>>v...v>.>vv.>v>>.>..>.>>>...v..v.v.>v....>>v.vvv.v.>>...v.v>.vv..v.v.v.>.>>....vv>v.>>.>.>.v>.v>>>.....>.v>.>v>...>.>..
...>>..vv.>.v.v....>>..>.v..>v>.v...>...>v>v>v.>.v.vv>v....>v....>>>v..>>..>....>.>>>v.>.>...v..>>>.>vv..v>v....>....>..vvv>v>v.v>v..vv....
>vv>..>.vv.>>.v...>.>.>>.>v..v>vv...>v....v.vv>....v>...v.vv>...>>>.vv...>...v....>.v....>...v.vv..>.>v..>...>>>..>.v.v.v>>...>..>..>..v.>>
..vv>v>v>>>vvv>.vv>>vv..>>v>>..>v.>>.......>vv.v.vv....>v>..>.v>vv>>.vv.>>..vv.v>>>v.>...>....>>v>.......v>>>>.v>>>>>v.>>...>v.>vv.>.vv.>.v
>v>.v.>.>..>>>.v..>.v..>v..vvv.>..v>.>>.....v....vv.>..>.v.vv...v.v>.>.vv.>....>v..v>.v..>..>....>.v..v..>v>.>>..vv...>..v....>>v..>.v>>.v>
.>..>.....>vvv>.>..v>v.v..>vvv....>v>>>...>..>.>vvv..v.vv.>...>>v.....v.v..v>>>.v.>>vv..v.v..v......vv>v.>>.v.>v.>>>>..>v..v>.....v>.>v.v..
vv>.....>v>>v.>.>.>vv....v>..v.>.v.>vv>v......v.>>..>>.v>>>>.v>....v..>..v>.v.....>>.>....v.>...>v>>>>>.v.>.......>>v>...v..>>vv..>..>v.>vv
>>vv>..v.....v.v>vv.>..v>..vv>...>>>....>..v>v...>...vv.>>.>v>v>>..v.>...v...>.vvv.>>.>.v>v>.>>>...>..v.v>.vv>v.>.v..>...v..v..>..v..v.v>v>
v>....v.v>...vv...>v..v>v...>.>vvv....>.v...>>>v...>...v>>.v>v>>v>..>>>v.>..v.v.v>.v.vv>>..v.>.>..>>.v>v.>>>>...v>>.v.v>.>.v...>vv.vvvv.>v.
...vv...v.>.>.vvvv..v>.vv>.v.>.v>.>v>v......v...>v>>v...v>.>..>..>.>.>>>vv..>..>>.>v..>>>.>v>...>>>.>.>>v.v..v>...v>..v..v.>..vv.v.....>.>.
.>..>.>...........>.>.>v.>>>>v>.>v>.vv...v..>v.vv>..vv.>v.>>>..v.vv.....>>.v...>vv>.>>.v..v.....>v.....>vv.>vv...vv.vv>v.v....v......v..>vv
>v>..v>>>v>>vvv.....v..>>>v..>>>v..>>v>vv.>...v>.>>>.v.vv...v...v>>.....v.>vv..>..>>.vv.>..>......v.>....vv.>vv.....>>v...v>>v.vv>>..>.vv..
>.>v>>v..>.v..vv>.>....v..>>v....>...v>vv>.....vv.v...>v>.v>>..vvv......>...v...>v.v..>.>>.v>...>>>.vv.v>v...v.>...v..v.>v..>>v>>v..>...v..
>.>.>vvv>>.v...v..>v..>>.....>v.....>>vv.v>..>v...>v...>.v.v>>.v>......>>v...>..>.>......>.>..>...vvv>vv>.v.v.v>..vvv>.>.......v.v.>>>v>v>.
...v.v.>.v.>.>.v.>.>>v>v..>>..>>.vv..>>.>>.v>v>>.>...>>>.v.vv>..vv>...>>vv....v.>.v...>>..vv>.>..v>v...>..v..>>....>>>v.vv>>v..>.v....>.>.v
>>v.>>.v>>....>..vvv>v>>v..>vv....>.....vv.vvv>........>v.v.vv>>.v..>v.vv>vv.>>...>..>.v>.>.>>.v.v>v>...vv..v.v>..v>.v>....>vv>>....vv>...v
v.v...v.v.vvv>vv>.vvv.vv.>v>v.v....>.....>>..>.vv.>.>..v....v..v.v...vv.vvvvv......>v.vv..v>v>vv.v...v.>...v>>>v.v>v>.>..vvv.>.v.>v.>.>>v..
...>>>>.v..v.>..v.>v.v>..vv.>.>vv.>>.v>.>....v..v...>.>..vv.>..v.>.v>>...>.>...v.>>.>.vv>v>.>.>..>vv.>vv>...>.v.>.v..>>..>..v>vv.v.v.v.....
.>..vv...vvv>.....vvv>.>v.>vv.v..>.>vv.v.v..>>>..>v.v..vv..>..>v.v>>v...>>.>>.v>>v>..>...>>vv>>..v>......v>.>.v.v...v..v.v.v.v...vv..v>..v.
...v......vv>v.vv>>>.v.>.v.v.....v..>>v.>v.vv>v>>....>......v...>>..>....>>vvv.>v..>....>..v>>>>.>>v>v..>>>.>>v>>v....v.>v.vv>.>....v.>...>
..>>>>v>...v.v..vv>...v>>>>.>..v>.........v.>.>...v.>>...>..v>.>...v..vv.v>>.v..>.....>..>vv.v.v.>.>v>..v>>v.v>v>v>.....>vvv.>>>>>>vvv>.v.>
.v..v....v.vv.v.v..vv>..>>v....v.vv...>.>...>>.v.vv....v>.v.v.>>v>....vv>>..v...v....>.>>.>v......>>.v>v..>..v>vv.>..>>>....v..>...vvv.>>v>
..v>.v....v.>.>v>.>.v...vv>>..>.v...>>v.v...>>..vv>.....v.vv.>>>v>.>..v.>>v......vv>>v.>v..v>>..>..>>..>...>vv....v.vv..v>v.vv...>...>.>v>>
>.vvv.......>.>>...v>v..>.>>v..v.vvv..v.v..>..>>vv>.vv>..v..>...v.v....v.v........>v>>>.vv..v.....>.>v.>v.>v.v........>>v>.v>..>.>..>v>v...
....>vv...v.>>...vv>.....v....v>v.>..vv>.v.vv>>..v>v.v.v.v>vv..v..>v>.v....>v>...>v.....>v...v..v.>.>v>....>....v.v..>>v>>v..>>>>v>>>.>>...
.....v>v>.>.v...v.>>..v>>>>vvv.vv...vv>>.>..v..>v>..>..>..>vv>v....>>v..vv>..v>..>.v..>>vv>>v.v>...>>>.vv.>>.>..vvv>>v>..>v..v.>v.>..v.>...
v..>.>v>.v....v>>>.>...v...v.>>>>..vv...>.>>.>>v.>.>v..v>..>v>....>v>.v>>v.v..v>>.v.>...>..>v...>>>....>vv..v>>v.>>...>v.v.>v...>....>.>v..
...v>>.v.v.....v......>v.....vv>>.>.v.v>.>>>.vv>>.vv..>...>....v>..v>>>>.v..v>>>v>.v>>..>.>...>v...vvvv.>.v...>.>v.>v.>..vv.....>>>>..v..v.
..>>.>>..v>..>vv>>.>.v.vv....>v.v.>>>v>v.v>vv>>>vv...vv.>>...>.v.....v.>.>>.>.vv.v.>>v...vv..vvvv.>....v..>>.>>v.>.v>v.>...v.>.vv.v>>...v>v
..vvvv.v..>v.....>..v.>.>>v.v...>>..>.>.vv...v>v..>.>....>.v.v..v>.....vv...v....>....>...>v..vv>vv...v...>.>..>....>.v.>>v.v.>v.v>.vv>>vv>
.v..>vv>>>.v.>v..>v.>>.v.v...>.v..v.v.....>vv.v.>>vv...v>.>.>....vv.>..vvv.>...v>v>>.>...>>>>..v..v..vv...>.>.v..vv>.>v..>..v.....v.>...v.v
>.v...v.vv>>......>>>>v....>v.>vv>.>>.>v>v..v...>>v..>....v.v.....>...>v....vv.v>....>.>..v.vv..v>v>.>v....vv..v..>v........>.v>.v.........
v.>..vv>...>>.v.vv..>.>v>....v..>.vv..>..>>.>..>vv...v..vvvv>....v..>v.v.>.>.v>....v..>>v>>...v.>>v.v..v.v...>v.v>..v..v>.......>.v...v.vv.
v.>v>v>v>>>...v>.>>..v.>vv>.v..>.vv.>>v>v..>>vvv>.v.....>>.>v.v..>....v.>v.>v.....v>.v>>...v>..>..v.v....v..v...>.v..v....>>.>vvv>..>>.vv..
>v>>.>..v....>v.v...>>>v.>.>..v.>.vvv>v..vv.>vvv.v.>>>v>vvv.>>.>.v.......>>.>.>v>..vv>......v.>>>..v>vv..>..>>..v>vv>>vv.vv.vv.v...v...v.>>
.>.v..v.vv>.>.v..........vv...vvv.v.v.>........>....v>v.vvv.v..v>.....vvv>..v...>..>v>v>>v.>v>v..>.>v>v..v.>.v.>v.>..vvv>.>>>>.vv>>..>v>>.v
.....>vvvv..vv.vvv...vvv...vv>vv.v>>>.v>..v>.v...vv.vv>vv>.>vvvv...>vv...vv>.vv>>>..>.>>>.>vv..>...v.>...vv.>>>...v...vv.>vv.>vvv....>v>>.v
v>..>..v>>>v.>>v.vv>v>..vv>.>....>>>......>..>>..v.>..vv.v...v.>.vv.>>.>>.>..v.......>v.v.>.v.v>.v.v>>.v..vv>.vv.>>>v.v>...>...vv..v.>v>.v.
v.vvvvv..v.>.>.v.>..>>>..vv.>>>vv.......vv..v.....v.vv...v.v>.....>>.vv..>.>>.v..>v.v.v>.>>..v.>........>.v>..>v>>>>>>v.>..>..>v>.vv.vvv...
>..v>v.>>v>v.>..>>vvv>..>v>>v>..>.v.>>.vvv>.>vv.>vv.v........v>v.v..>...>v....v...>.v.>...>vv...v..vv........>...>v.v>..v..v>>..v.>>.v.vv>.
..v.v>.v.v.v>v....>.>>>.>.v>>..vvv>v>.v.>vv.>..>.v>v>v.>vv.vv.v.v.vv..v>.vv.vv.vv.>>...vvv.>..>.>v>......v.>.v>vv.>.v..vv>.v>.v>>.....v.>.>
v.v....>>..v...v>v>vvv....>>....>v>vv.vv>v.>>.vv..>.v.>....>>v..>>>vv..>.......>>....vv.>v>v.v.....v.>.>.>v>>>>..>>..v.>...>>>...vv>v>..>v.
.>.>..vv>>>...vvv.v>..>>v>v.v.v>vv..vv>v>>.vv....v>>v....v>>.vv>v...v..>v>v>.>.>.>>>....>.>.>..vv>v.v.>>...>v>..>.>vv.>..vv..>v..>v.v.....v
>v........>>v....v..>v.v..>.vv>..>v.v.v>>>>v>>vvv>.v>v.>.>.v.v.vvv..vv>..>..>v>.v>..>v.v...>.>.v>..>vvv.....v......>>>.>.v>.>vvv..v>.>v>vv>
..v.>>>>.>v.>>>.....>v>.>..vv..>>v..v.>.....>vv...>>..v..v.v..v>.>..>vv.>...v.v....v.>v.>.>...vvv.vv>.....v.....>.v>.v>.>..>....vv.>v.v....
.v>>.......v.v.v..>>..>v..>vv....>vvvvv.>.>..>...vv.>>v..vv....>v>.>>.>.vvv.>.v....vv>v.vv.>vv......>.>>>>.>.>vvv>vv.v.v..>.v..>..>.......>
.vv..>>..>....vv.vv..>.>.....>>.>.>..vv...>v>.vv>..>v.v>.>...>..v.vv..>.>v>>...>v..v...v...v>.>>>>..>.>>v....>.v..v.v.....>>v.....v.vv....v
..vv>vv...v.>>>v....v>.vv..v>v.>.v>.>v>>.>.v..>.vv...>.v.>.>.v..v.>..v.>>>..>..vv.>..>..>v>..>.>v...v>...>>>....>v...v.vv.>>.vv.>vv>v>>>.>>
>..vv>>vvv..>vvv..v>v.>...>..v>>vv.>v..>.v>.>.>.>v.>vvv>>.>.......v...>>v..>...vvvv>>v>.v..>>vvvvv.v..v>.>..>v....>..v>...>vv>>v.>vvv>...>.
v.v..>..>v...v..>>>v..v>.vvv....>v.v...v.v.>...vv.>v>.v>...>vv>vv.v>vv.v.v..vvv>..>>v.v>v>..>.>v..v..>vv>v.......>.>.v.>..vv.v.v>>.>.>...vv
...>>>v..>v..>>v.>.vvv.v.>>..>..vv>v.......>v.>.>....>v.vv.>..v>...v..>..v>...v>v.....v..v.>>>>>.>.>vv..>vv>vvv.>>>>..>.>v.v.v.>>>.v...>v>.
..vvv..>vv>.vv>v>.>>.>v.>vvv......>..>v...v.v.>.v..>vv>.vv.vvv>.......>.>...v>v.>v..v.>v.>v>vv...v>.>v.>v.v.....v.>>>v.>.v.v>.v..v>.vv....>
>v..v.v..v>>.>..>>...v.>.>......>..>.v.vvvv>vv>v..v>vvvv.>v..v>.....>..>>>...>.v..vv>v>.>..>v..v..v>>.....>.>>>...v>......>.vv..vvv>>......
.>>.v........vv.>.>.v>....v......v.>.>>..>v.v..>....>>.>.....>vv..>.>>.>v.vv..vv....>>..v.vv.>..>.>...>vv..v....>>>...>.v..v..v.>>...v>v...
>v..v.>>>>>....v...>..vv>.>.>>..>vv>vv.>>..>.>..v.vv>v.>>.>..v..v..>>vv.v>...v>v>v..>.>v.vvv...>>.v..>.>>.>>.....>.v>.>v.vv..vvv>......>v>.
....>.>>>>v>>.v>>...v..>>>.vv..v>>..>>.v.v>.v.v.>...v.>>...>v..v....vv.v.....v....>......>.....vv.>.vvvvv>....>vv..>>>v>vv>>v.....>>...v...
.>.....>v>...>v.>>..>v.>v>....vv..v>>..>.vv.v...v>..>..vv.v>..v..>v...>>v..v..v>v.v>.>v>v....v>.v>.vv..v....v.>>..>v..vv.v..>v>>.>>>..vvv.>
>v>>>v...>.>>vvv....v>vv...>...>v..>...>.>....v.v..>>..v>..vv>>>.........>v.v...>v......>>.>vv.......>.>.>..>..>>v>v.v..vv...>>v..>v>.>vv>>
..>v>v>v.vvv.v>.v>>>..>>v>....>.v.>...v>...>v.vv.vv>v..>.>v>vv.v.v.>...vv...v>>>>>vvv.>.v>.vv...>v....v.>...v..>..v..v.v...v>v.v.>v.>v..v..
.v.v.v.v>>.>.>.>>..v.v..v..v.v.>.>.>v>>.v....>>>....>>v>..>v....v......vv.>>..>...>...>>>.>.>>..v.>..>....>..v..vv.vvv>vvv...>>v>>.vv>v>v..
..>.v.>v.>>>>>>....vvv.v>.v.vv.>..v>v.........vv>.>v.v>v.vvv....>v>vv.>>..............v.v>>>..v>..>.>..vv....>.v>...>...v.....>>.vv>.v>..vv
.v...v.>.>.>>vv..>v>.>..>..vv>.>v...v>v.v..>v>.>>...v>v>...v...>..v>>........>v.>..v>..vv.v>v.>.vv>>.>vvv>v.>>>>>.v.v........>>>>..>.vv>v.v
>..v>v...>........v..>.>......v..v.>v.vv>>>>.>.>v.v>..>v.>>>vv....>....>v..>.>.>.v.vvv..>vv>..>v.......v>>>..vv..v..>v>>>...>v.>v.v>...vv>>
>.>....vv.vv.vv.vvv...v>>..>..>.>v.v>>.v.>v.v..>..>....>v..>>>>v.>..v..>>>v.v..v>>....v....v..>>>.>.v.>..>v..>...v...>v..v.>.v......v>.v.v.
.v.v..>....v..>v>vv.v>v>.v>.vvv......>.v..v.v.....>>.v...>..>..vv.>>.>.v..>....>.v>vv>..v>...>.>>vv>.vvvv.v.v>...>....>...>v.v...vvvv>....>
......v>v.vv..>v...vv..v>v....>.>v.>....>....>.>.>.>>...>>.v.>.>.>>v.v>.vv.v>>..>.>.v..>..>.v.....v.v.vv>.vvv....v.>..>.v.......v>.>..vv.v.
>>>...>.>vv>>>>>.>..........>vv>>...v....v.....v>vv.vv>..v>>..v...v>v.....vv>...vv.v..>.v..vv.v>.v.v.>.vvv.vv.>.>...>v>v..>.v>...>v...v.>.v
..>vv.....v.>.>>....vv........vv..>v..v.>.>.....>v>v>>.v.v.>>..v..vv.>v.>vv>v.>.>.vvv.>vv..v.vv.>.>>v....v..v.....v.v>v...v.>.vvv..v..>.>>.
v>vv>>v>.....v..v>v>v...v..>v..v>>.>v.vv>v>>.>..v.v...v>...>v.v.vv.>.v>v>.v...v.>vv>..>..>v.....v.>>...v>vvv>vv....>.v..>v....>..v>>v.>.>.>
.>.>.>.>>.>v.>.v.v..v.v..>v>>..v...>....v>v...v.v..v>.v...v>>v>>.vv...>>.>>>.>...v>vv>....>>..v.>v.v..>.....>>..>>>....v.>>..v..v.v.>..vv..
"""


class SeaMap:
    "Simulates the sea cucumber movements"

    def __init__(self, input_: str) -> None:
        self.input_ = input_
        self.process_input()

    def process_input(self):
        "0 is an empty space, 1 an east-facing cucumber, 2 a south-facing cucumber"
        self.grid = np.array(
            [
                list(row.translate(str.maketrans(".>v", "012")))
                for row in self.input_.splitlines()
                if row.strip()
            ],
            dtype=int,
        )

    def move(self) -> bool:
        """The ballet of sea cucumbers.The `np.roll` function conveniently wraps when a cucumber
        reaches an edge.

        Returns:
            bool: whether at least 1 sea cucumber moved
        """
        # east-facing herd
        cucumbers_east = np.where(
            np.logical_and(self.grid == 1, np.roll(self.grid, -1, axis=1) == 0)
        )
        move_to_east = np.where(
            np.logical_and(self.grid == 0, np.roll(self.grid, 1, axis=1) == 1)
        )
        self.grid[cucumbers_east] = 0
        self.grid[move_to_east] = 1
        # south-facing herd
        cucumbers_south = np.where(
            np.logical_and(self.grid == 2, np.roll(self.grid, -1, axis=0) == 0)
        )
        move_to_south = np.where(
            np.logical_and(self.grid == 0, np.roll(self.grid, 1, axis=0) == 2)
        )
        self.grid[cucumbers_south] = 0
        self.grid[move_to_south] = 2
        if not cucumbers_south[0].size and not cucumbers_east[0].size:
            return False
        return True

    def show_grid(self) -> None:
        """Pretty prints the grid, for debugging purposes"""
        for row in self.grid:
            print(*row)
        print("\n")

    def solve_p1(self) -> int:
        """Moves cucumbers until it becomes impossible

        Returns:
            int: The number of steps before no movement is possible
        """
        nb_steps = 0
        while True:
            nb_steps += 1
            if not self.move():
                break
        logging.info(f"Part 1: {nb_steps=}")
        return nb_steps


if __name__ == "__main__":
    testmap = SeaMap(INPUT_TEST)
    assert testmap.solve_p1() == 58
    actualmap = SeaMap(INPUT)
    actualmap.solve_p1()
